"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[288],{453:(e,s,t)=>{t.d(s,{A:()=>r});t(43);var a=t(579);const r=()=>(0,a.jsx)("aside",{className:"spinner-container",children:(0,a.jsx)("div",{className:"spinner"})})},288:(e,s,t)=>{t.r(s),t.d(s,{default:()=>l});var a=t(43),r=t(906),n=t(867),c=t(453),d=t(213),o=t(579);const l=()=>{const[e,s]=(0,a.useState)([]),[t,l]=(0,a.useState)(""),[i,h]=(0,a.useState)([]),[u,m]=(0,a.useState)({sales_count:0,total:0,total_buyer:0}),[p,j]=(0,a.useState)(!1),[x,g]=(0,a.useState)("Dashboard"),[y,b]=(0,a.useState)({id:"",name:"",price:"",image:null}),[f,N]=(0,a.useState)(!1),v=(0,a.useRef)(null),[w,C]=(0,a.useState)(!1),S=(0,r.Zp)(),[P,D]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(async()=>{try{j(!0);const e=await fetch("https://medmorestore.onrender.com/products"),t=await e.json(),a=await fetch("https://medmorestore.onrender.com/sales"),r=await a.json(),n=await fetch("https://medmorestore.onrender.com/orders"),c=await n.json();console.log("Fetched orders:",c),h(t),m(r),s(c)}catch(e){console.error("Failed to fetch data",e)}finally{j(!1)}})()}),[]),(0,a.useEffect)((()=>{if(v.current&&v.current.destroy(),u.sales_count>0&&"Dashboard"===x){const e=document.getElementById("salesChart").getContext("2d");v.current=new n.Ay(e,{type:"line",data:{labels:["Jan","Feb","Mar","Apr","May"],datasets:[{label:"Sales ($)",data:[1200,1900,3e3,5e3,2400],borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.4}]},options:{responsive:!0,plugins:{legend:{position:"top"}}}})}return()=>{v.current&&v.current.destroy()}}),[u,x]);const E=e=>{const{name:s,value:t}=e.target;b({...y,[s]:t})},k=e=>{b({id:e.id,name:e.name,price:e.price,image:null}),N(!0)},A=i.map((s=>{const t=e.reduce(((e,t)=>t.product_id===s.id?e+t.amount:e),0);return{...s,totalSales:t}})).sort(((e,s)=>s.totalSales-e.totalSales)).slice(0,5),F=e.reduce(((e,s)=>(e[s.payment_status]=(e[s.payment_status]||0)+1,e)),{});return(0,a.useEffect)((()=>{if(t){const e=setTimeout((()=>{C(!0)}),5e3);return()=>clearTimeout(e)}C(!1)}),[t]),p?(0,o.jsx)(c.A,{}):(0,o.jsxs)("div",{className:"admin-dashboard",children:[(0,o.jsxs)("aside",{className:"sidebar",children:[(0,o.jsx)("h2",{children:"Admin Dashboard"}),(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{onClick:()=>g("Dashboard"),className:"Dashboard"===x?"active":"",children:"Dashboard"}),(0,o.jsx)("li",{onClick:()=>g("Products"),className:"Products"===x?"active":"",children:"Products"}),(0,o.jsx)("li",{onClick:()=>g("Orders"),className:"Orders"===x?"active":"",children:"Orders"}),(0,o.jsx)("li",{onClick:async()=>{try{const e=await fetch("https://medmorestore.onrender.com/logout",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw new Error("Failed to log out");const s=await e.json();console.log(s.message),S("/")}catch(e){console.error("Logout error:",e),alert("Failed to log out. Please try again."),l("Failed to log out. Please try again.")}},className:"logout-button",children:"Logout"})]})]}),(0,o.jsxs)("main",{className:"dashboard-content",children:["Dashboard"===x&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("section",{className:"analytics",children:[(0,o.jsx)("h3",{className:"text-center my-3",children:"Analytics Overview"}),(0,o.jsxs)("div",{className:"analytics-cards mt-2",children:[(0,o.jsxs)("div",{className:"analytics-card",children:[(0,o.jsx)("h4",{children:"Total Revenue"}),(0,o.jsxs)("p",{children:["\xa3",u.total]})]}),(0,o.jsxs)("div",{className:"analytics-card",children:[(0,o.jsx)("h4",{children:"Total Orders"}),(0,o.jsx)("p",{children:u.sales_count})]}),(0,o.jsxs)("div",{className:"analytics-card",children:[(0,o.jsx)("h4",{children:"Total Customers"}),(0,o.jsx)("p",{children:u.total_buyer})]})]}),(0,o.jsxs)("div",{className:"order-summary",children:[(0,o.jsx)("h4",{children:"Order Summary by Status"}),(0,o.jsx)("ul",{children:Object.entries(F).map((e=>{let[s,t]=e;return(0,o.jsxs)("li",{children:[s,": ",t]},s)}))})]})]}),(0,o.jsxs)("section",{className:"chart",children:[(0,o.jsx)("h3",{children:"Sales Report"}),(0,o.jsx)("canvas",{id:"salesChart",width:"400",height:"200"})]}),(0,o.jsxs)("section",{className:"top-products",children:[(0,o.jsx)("h3",{children:"Top Selling Products"}),(0,o.jsx)("div",{className:"top-products-grid",children:A.map((e=>(0,o.jsxs)("div",{className:"top-product-card",children:[(0,o.jsx)("h4",{children:e.name}),(0,o.jsxs)("p",{className:"product-price",children:["Price: \xa3",e.price]}),(0,o.jsxs)("p",{className:"total-sales",children:["Total Sales: ",e.totalSales]}),(0,o.jsxs)("div",{className:"actions",children:[(0,o.jsx)("button",{className:"view-button",children:"View"}),(0,o.jsx)("button",{className:"edit-button",onClick:()=>k(e),children:"Edit"})]})]},e.id)))})]})]}),"Products"===x&&(0,o.jsxs)("section",{className:"products",children:[(0,o.jsx)("h3",{children:"Product List"}),(0,o.jsxs)("form",{onSubmit:f?async e=>{e.preventDefault(),D(!0);const s=new FormData;s.append("name",y.name),s.append("price",y.price),y.image&&s.append("image",y.image),console.log("Form Data:",s);for(const[a,r]of s.entries())console.log(`${a}:`,r);try{const e=await d.A.put(`https://medmorestore.onrender.com/products/${y.id}`,s,{headers:{"Content-Type":"multipart/form-data"}});if(200!==e.status)throw new Error("Failed to update product");const t=e.data;h((e=>e.map((e=>e.id===t.id?t:e)))),b({id:"",name:"",price:"",image:null}),N(!1),l("Product Updated successfully!")}catch(t){console.error("Error updating product:",t)}finally{D(!1)}}:async e=>{if(e.preventDefault(),D(!0),!y.name||!y.price)return void alert("Please enter product name and price");if(!y.image)return void alert("Please select an image");const s=new FormData;s.append("image",y.image),s.append("name",y.name),s.append("price",y.price);try{const e=await d.A.post("https://medmorestore.onrender.com/products",s,{headers:{"Content-Type":"multipart/form-data"}});console.log("New Product Added:",e.data),h((s=>[...s,e.data])),b({id:"",name:"",price:"",image:null}),l("Product added successfully!")}catch(t){console.log(t.message),console.error("Complete Error:",t.response?t.response.data:t.message),alert(),l(`Failed to add product: ${t.response?t.response.data.error:t.message}`)}finally{D(!1)}},children:[(0,o.jsx)("input",{type:"text",name:"name",placeholder:"Product Name",value:y.name,onChange:E,required:!0}),(0,o.jsx)("input",{type:"number",name:"price",placeholder:"Product Price",value:y.price,onChange:E,required:!0}),(0,o.jsx)("input",{type:"file",name:"image",placeholder:"Product Image",accept:"image/*",onChange:e=>{const s=e.target.files[0];console.log("Selected File:",s),s&&b((e=>({...e,image:s})))},required:!f}),(0,o.jsx)("button",{type:"submit",children:f?"Update Product":"Add Product"}),f&&(0,o.jsx)("button",{type:"button",onClick:()=>{b({id:"",name:"",price:"",img:null}),N(!1)},children:"Cancel"})]}),P&&(0,o.jsx)(c.A,{}),(0,o.jsx)("div",{className:"products-grid",children:i.map((e=>(0,o.jsxs)("div",{className:"product-card",children:[(0,o.jsx)("img",{loading:"lazy",src:e.img,alt:e.name}),(0,o.jsx)("h4",{children:e.name}),(0,o.jsxs)("p",{children:["Price: \xa3",e.price]}),(0,o.jsxs)("div",{className:"actions",children:[(0,o.jsx)("button",{onClick:()=>k(e),children:"Edit"}),(0,o.jsx)("button",{onClick:()=>(async e=>{try{if(!(await fetch(`https://medmorestore.onrender.com/products/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete product");h((s=>s.filter((s=>s.id!==e))))}catch(s){console.error("Error deleting product:",s)}})(e.id),children:"Delete"})]})]},e.id)))})]}),"Orders"===x&&(0,o.jsxs)("section",{className:"orders",children:[(0,o.jsx)("h3",{children:"Order List"}),e.length>0?(0,o.jsxs)("table",{className:"orders-table",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Order ID"}),(0,o.jsx)("th",{children:"Amount"}),(0,o.jsx)("th",{children:"Currency"}),(0,o.jsx)("th",{children:"Email"}),(0,o.jsx)("th",{children:"Address"}),(0,o.jsx)("th",{children:"Payment Status"}),(0,o.jsx)("th",{children:"Created At"}),(0,o.jsx)("th",{children:"Updated At"})]})}),(0,o.jsx)("tbody",{children:e.map((e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e.id}),(0,o.jsxs)("td",{children:["\xa3",e.amount]}),(0,o.jsx)("td",{children:e.currency}),(0,o.jsx)("td",{children:e.email}),(0,o.jsx)("td",{children:e.address}),(0,o.jsx)("td",{children:e.payment_status}),(0,o.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,o.jsx)("td",{children:new Date(e.updated_at).toLocaleString()})]},e.id)))})]}):(0,o.jsx)("p",{children:"No orders available."})]}),t&&(0,o.jsx)("div",{className:"alert-popup "+(w?"alert-popup-exit":""),children:t})]})]})}}}]);
//# sourceMappingURL=288.d2ed1955.chunk.js.map