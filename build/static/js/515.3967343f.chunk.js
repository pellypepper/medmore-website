"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[515],{453:(e,a,t)=>{t.d(a,{A:()=>n});t(43);var r=t(579);const n=()=>(0,r.jsx)("aside",{className:"spinner-container",children:(0,r.jsx)("div",{className:"spinner"})})},515:(e,a,t)=>{t.r(a),t.d(a,{default:()=>d});var r=t(43),n=t(393),s=t(906),o=t(910),l=t(929),i=t(453),c=t(579);const d=()=>{var e,a,t;const[d,m]=(0,r.useState)(!1),p=(0,n.useStripe)(),u=(0,n.useElements)(),[y,h]=(0,r.useState)(null),[x,v]=(0,r.useState)("card"),[j,g]=(0,r.useState)(""),E=(0,s.zy)(),f=(null===(e=E.state)||void 0===e?void 0:e.total)||0,S=(null===(a=E.state)||void 0===a?void 0:a.form)||{},C=(0,s.Zp)(),[b,_]=(0,r.useState)(!1),T=(null===(t=E.state)||void 0===t?void 0:t.cart)||[],N=async(e,a,t)=>{try{const r=await fetch(`${{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL}/payment/record-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,paymentIntentId:a,cart:t})});if(!r.ok)throw new Error(`Failed to record payment: ${r.statusText}`);if(!(await r.json()).success)throw new Error("Payment was not recorded successfully.");g(' "Payment recorded successfully!" ')}catch(y){console.error("Error recording payment:",y),h("Failed to record payment on server.")}};return(0,r.useEffect)((()=>{if(j||y){const e=setTimeout((()=>{_(!0);const e=setTimeout((()=>{g(""),h(""),_(!1)}),500);return()=>clearTimeout(e)}),5e3);return()=>clearTimeout(e)}}),[j,y]),(0,c.jsxs)("div",{className:"card-section",children:[(0,c.jsxs)("div",{className:"card-wrapper",children:[(0,c.jsxs)("div",{className:"card-text",children:[(0,c.jsxs)("p",{children:["$",f]}),(0,c.jsx)("p",{children:"Payment"})]}),d&&(0,c.jsx)(i.A,{}),(0,c.jsxs)("form",{className:"mt-2",onSubmit:async e=>{if(e.preventDefault(),!d)if(m(!0),h(null),g(""),p&&u)try{const e=await fetch(`${{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL}/payment/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:f,paymentMethodType:x})});if(!e.ok)throw new Error(`Failed to create payment intent: ${e.statusText}`);const{clientSecret:a}=await e.json();if(!a)throw new Error("Client secret is missing in the response.");let t;if("card"===x){const e=u.getElement(n.CardNumberElement),r=u.getElement(n.CardExpiryElement),s=u.getElement(n.CardCvcElement);if(!e||!r||!s)return h("Card elements are not available."),void m(!1);t=await p.confirmCardPayment(a,{payment_method:{card:e}})}else if(["apple_pay","google_pay","klarna"].includes(x))return h(`Payment method '${x}' is not yet supported.`),void m(!1);t&&t.error?h(t.error.message):t&&t.paymentIntent?(await N(S,t.paymentIntent.id,T),C("/order",{state:{order:{id:t.paymentIntent.id,total:f,email:S.email,items:T.map((e=>({name:e.productName,quantity:e.quantity})))}}})):h("An unexpected error occurred during payment confirmation.")}catch(a){h(a.message)}finally{m(!1)}else m(!1)},children:[(0,c.jsxs)("label",{className:"label",children:["Payment Method:",(0,c.jsxs)("div",{className:"payment-div",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("input",{type:"radio",onChange:e=>v(e.target.value),name:"paymentMethod",value:"card",defaultChecked:!0}),(0,c.jsx)("img",{src:"card.webp",alt:"card"})," Card"]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("input",{type:"radio",onChange:e=>v(e.target.value),name:"paymentMethod",value:"apple_pay"}),(0,c.jsx)("img",{src:"apple.webp",alt:"apple"})," Apple Pay"]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("input",{type:"radio",onChange:e=>v(e.target.value),name:"paymentMethod",value:"google_pay"}),(0,c.jsx)("img",{src:"google.webp",alt:"google"})," Google Pay"]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("input",{type:"radio",onChange:e=>v(e.target.value),name:"paymentMethod",value:"klarna"}),(0,c.jsx)("img",{src:"klarna.webp",alt:"klarna"})," Klarna"]})]})]}),"card"===x&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("label",{htmlFor:"card-number",children:"Card Number"}),(0,c.jsx)(n.CardNumberElement,{id:"card-number",className:"card-element full-width",options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}}),(0,c.jsx)("label",{htmlFor:"card-expiry",children:"Expiry Date"}),(0,c.jsx)(n.CardExpiryElement,{id:"card-expiry",className:"card-element",options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}}),(0,c.jsx)("label",{htmlFor:"card-cvc",children:"CVV"}),(0,c.jsx)(n.CardCvcElement,{id:"card-cvc",className:"card-element",options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})]}),(0,c.jsx)("button",{className:"button",type:"submit",disabled:!p||d,children:d?"Processing...":`Pay Now $${f}`}),y&&(0,c.jsx)("div",{className:"error",children:y})]})]}),j&&(0,c.jsxs)("div",{className:"success-popup "+(b?"success-popup-exit":""),children:[(0,c.jsx)(o.g,{icon:l.SGM,color:"green",size:"2x"}),(0,c.jsx)("p",{children:"Payment Successful"}),(0,c.jsx)("p",{children:j})]}),y&&(0,c.jsxs)("div",{className:"error "+(b?"error-exit":""),children:[(0,c.jsx)(o.g,{icon:l.tUE,color:"red",size:"2x"}),(0,c.jsx)("p",{children:"Payment Declined"}),(0,c.jsx)("p",{children:y}),(0,c.jsx)("button",{className:"mt-1",onClick:()=>h(""),children:" Try Again"})]})]})}}}]);
//# sourceMappingURL=515.3967343f.chunk.js.map